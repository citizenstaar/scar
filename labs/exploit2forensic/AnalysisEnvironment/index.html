<!-- 
=============================
______ _____ __  _____  __  
| ___ \  ___/  ||  _  |/  | 
| |_/ / |__ `| || |/' |`| | 
|    /|  __| | ||  /| | | | 
| |\ \| |____| |\ |_/ /_| |_
\_| \_\____/\___/\___/ \___/
                            
Site archive:   https://github.com/citizenstaar
Video archive:  https://www.youtube.com/user/CitizenXray

=============================
 -->
 
 
 <!DOCTYPE html>
<html>
<head>
    <title>RE+DFIR101 - Malware Analysis Short Stories</title>
    <link rel="shortcut icon" href="https://github.com/citizenstaar/scar/images/re101.png">
    <link rel="alternate" href="https://github.com/citizenstaar/scar/rss/rss.xml" type="application/rss+xml" title="RE101"/>
    <link href='https://fonts.googleapis.com/css?family=Share+Tech+Mono' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="https://citizenstaar.github.io/scar/css/style.css" media="screen">
</head>


<body>
    
    <div id="page">
        <div id="content">

        <!--HEADER SECTION -->
     <div id="header"><pre>
<a class="node" href="https://github.com/citizenstaar">
  ____  _____ _____ ____  ______   ______  
 |  _ \| ____|_   _|___ \/ ___\ \ / / ___| 
 | |_) |  _|   | |   __) \___ \\ V /\___ \ 
 |  _ <| |___  | |  / __/ ___) || |  ___) |
 |_| \_\_____| |_| |_____|____/ |_| |____/ 
                                           
                                                     
<center><h1>DFIR101 - Exploit2Forensics</h1></center>		
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</pre>
            </div>


            <!--THE LIST -->
            
            <div id="list">
            
            <ul>
<h2>		ANALYSIS ENVIRONMENT SETUP</h2>
</br>
<li>Please assure you have done the following.</li>



<li>1.  Install a virtualization software.  Check out Oracle Virtualbox, Xen,  or Vmware Workstation.  (Feel free to choose a different product.)</li>
</br>
<li>2.  Grab a copy of Ubuntu 16:  ubuntu-16.04.1-desktop-amd64.iso from http://old-releases.ubuntu.com/releases/16.04.1/</li>
</br>
<li>3.  Add any virtualization tools needed based on the hosting virtualization software</li>
</br>
<li>4.  Open a terminal and execute "sudo su"</li>
</br>
<li>5.  Confirm you are running as root with "whoami"</li>
</br>
<li>5.  Install needed build tools with "apt-get install build-essential"</li>
</br>
<li>6.  Install kernel symbols "apt-get install linux-headers-4.4.0.31-generic"</li>
</br>
<li>7.  Install git tools "apt-get install git"</li>
</br>
<li>8.  Download LiME Toolkit "git clone https://github.com/504ensicsLabs/LiME.git"</li>
</br>
<li>9.  Download kernel symbol extraction tools "apt-get install dwarfdump"</li>
</br>
<li>10. Download additional utils for symbol extract "apt-get install dwarf-utils"</li>
</br>
<li>11. Download Python framework needed for Volatility Framework "apt-get install python2.7"</li>
</br>
<li>12. Download Volatility Framework "git clone https://github.com/volatilityfoundation/volatility"</li>
</br>
<li>13. Download supporting libraries for Volatility Framework "apt-get install pcregrep libpcre++-dev python-dev"</li>
</br>
<li>14. Download Python Install tools "apt install python-setuptools"</li>
</br>
<li>15. Download supporting module for Volatility Framework "easy_install pycrypto"</li>
</br>
<li>16. Download supporting module for Volatility Framework "easy_install distorm3"</li>
</br>
<li>17. Switch to git directory hosting Volatility Framework "cd ./volatility"</li>
</br>
<li>18. Enable all the things for everyone: "chmod 777 ./*"</li>
</br>
<li>19. Install Volatility Framework "./python setup.py install"</li>
</br>
<li>20. Exit the git repository for Volatility Framework "cd .."</li>
</br>
<li>21. Change directory to profile build tools in Volatility Framework "./volatility/tools/linux"</li>
</br>
<li>22. Execute make on kernel symbols with Volatility Framework tools "make -C /lib/modules/4.4.0-31-generic/build CONFIG_DEBUG_INFO=y M=$PWD"</li>
</br>
<li>23. Execute dwarfump on resulting file "dwarfdump -di ./module.o > module."</li>
</br>
<li>24. Collect current kernel version "uname -a"</li>
</br>
<li>25. Collect current distribution version "cat /etc/issue"</li>
</br>
<li>26. Bundle a profile based on kernel/distro used for file naming "zip ./Linux_Ubuntu_16_04_01_LTS_4_4_0_31_generic module.dwarf /boot/System.map-4.4.0-31-generic"</li>
</br>
<li>27.  Move the resulting profile to the overlay folder in Volatility Framework "cp ./Linux_Ubuntu_16_04_01_LTS_4_4_0_31_generic.zip /usr/local/lib/python2.7/dist-packages/volatility/plugins/overlays/linux"</li>
</br>
<li>28.  Change Directory back to download folder containing LiME Git "cd ../../.."</li>
</br>
<li>29.  Change Directory to the LiME src folder "cd ./LiME/src"</li>
</br>
<li>30.  Build LiME "Make"</li>
</br>
<li>31. Enter a editor and create the vulnerable code "vi vulnshell.c"</li>
</br>
<li>32. Press "Esc" then "i"</li>
</br>
<li>33. Paste the following:

#include <string.h>
#include <stdio.h>
void main(int argc, char *argv[]) {
	copier(argv[1]);
	printf("Done!\n");
}
int copier(char *str) {
	setuid(0);
	char buffer[100];
	strcpy(buffer, str);
}</li>
</br>
<li>34.  exit VI and write the file "Esc" + ":wq!"</li>
</br>
<li>35.  Compile the code by removing all compile time controls "gcc  -fno-stack-protector -z execstack -o copier -no-pie -m32 ./vulnshell.c"</li>
</br>
<li>36.  Change permissions to include SUID/GUID bit "chmod 5777 ./copier"</li>
</br>
<li>37.  Disable memory randomization "echo 0 | sudo tee /proc/sys/kernel/randomize_va_space"</li>
</br>
		

    </ul>
            </div>            
            <!--FOOTER SECTION -->

            <div id="footer">
                <pre>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</pre>
                <div class="filter">
                <a target="_blank" href="https://citizenstaar.github.io/scar/">HOME</a>
                <span class="footdogs">  &#215; </span>
                <a target="_blank" href="https://github.com/citizenstaar">GITHUB</a>
				 <span class="footdogs">  &#215; </span>
                <a target="_blank" href="https://www.youtube.com/user/CitizenXray">YOUTUBE</a>
				 <span class="footdogs">  &#215; </span>
                <a target="_blank" href="https://www.linkedin.com/in/peter-staarfanger-cissp-issep-b8504315/">LINKEDIN</a>
				<span class="footdogs">  &#215; </span>
				<a target="_blank" href="https://digitalfirstresponse.blogspot.com/">BLOG</a>
                </div>

        </div>

</body>
</html>